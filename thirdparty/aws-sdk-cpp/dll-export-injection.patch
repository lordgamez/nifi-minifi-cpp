diff --git a/generated/src/aws-cpp-sdk-s3/CMakeLists.txt b/generated/src/aws-cpp-sdk-s3/CMakeLists.txt
index f44ba56642..ee40d8bf44 100644
--- a/generated/src/aws-cpp-sdk-s3/CMakeLists.txt
+++ b/generated/src/aws-cpp-sdk-s3/CMakeLists.txt
@@ -59,6 +59,10 @@ if(USE_WINDOWS_DLL_SEMANTICS AND BUILD_SHARED_LIBS)
     target_compile_definitions(${PROJECT_NAME} PRIVATE "AWS_S3_EXPORTS")
 endif()

+if(FORCE_EXPORT_S3_API)
+    target_compile_definitions(${PROJECT_NAME} PUBLIC "AWS_S3_API=__declspec(dllexport)")
+endif()
+
 target_include_directories(${PROJECT_NAME} PUBLIC
     $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
     $<INSTALL_INTERFACE:include>)
diff --git a/generated/src/aws-cpp-sdk-s3/include/aws/s3/S3_EXPORTS.h b/generated/src/aws-cpp-sdk-s3/include/aws/s3/S3_EXPORTS.h
index f2d187c947..0a972d393c 100644
--- a/generated/src/aws-cpp-sdk-s3/include/aws/s3/S3_EXPORTS.h
+++ b/generated/src/aws-cpp-sdk-s3/include/aws/s3/S3_EXPORTS.h
@@ -22,7 +22,7 @@
             #define AWS_S3_API __declspec(dllimport)
         #endif /* AWS_S3_EXPORTS */
         #define AWS_S3_EXTERN
-    #else
+    #elif !defined(AWS_S3_API)
         #define AWS_S3_API
         #define AWS_S3_EXTERN extern
     #endif // USE_IMPORT_EXPORT
diff --git a/src/aws-cpp-sdk-core/CMakeLists.txt b/src/aws-cpp-sdk-core/CMakeLists.txt
index 1c4a8bd9fa..f1410a2053 100644
--- a/src/aws-cpp-sdk-core/CMakeLists.txt
+++ b/src/aws-cpp-sdk-core/CMakeLists.txt
@@ -586,6 +586,10 @@ elseif (BUILD_SHARED_LIBS)
     target_compile_definitions(${PROJECT_NAME} PRIVATE "SMITHY_EXPORTS=1")
 endif()

+if(FORCE_EXPORT_CORE_API)
+    target_compile_definitions(${PROJECT_NAME} PUBLIC "AWS_CORE_API=__declspec(dllexport)")
+endif()
+
 set_compiler_flags(${PROJECT_NAME})
 set_compiler_warnings(${PROJECT_NAME})

diff --git a/src/aws-cpp-sdk-core/include/aws/core/Core_EXPORTS.h b/src/aws-cpp-sdk-core/include/aws/core/Core_EXPORTS.h
index ecd5a39db7..f710630f90 100644
--- a/src/aws-cpp-sdk-core/include/aws/core/Core_EXPORTS.h
+++ b/src/aws-cpp-sdk-core/include/aws/core/Core_EXPORTS.h
@@ -19,7 +19,7 @@
             #define  AWS_CORE_API __declspec(dllimport)
         #endif // AWS_CORE_EXPORTS
         #define AWS_CORE_EXTERN
-    #else // USE_IMPORT_EXPORT
+    #elif !defined(AWS_CORE_API)
         #define AWS_CORE_API
         #define AWS_CORE_EXTERN extern
     #endif // USE_IMPORT_EXPORT
